# S.M.A.R.T. ゲームレコメンデーションシステム

14個の感情ラベル（14因子）を5個の型に変換し、5個の主観感情との共通印象を比較し、キーログから5個の主観感情を推定し、5個の型から最も適合するゲームタイトルをレコメンドするGUIアプリケーションです。

## 機能

1. **14因子から5個の型への変換**
   - ユーザーの好み（14因子）を以下の5つのゲーム型に変換します。
   - C1:ファンタジー型
   - C2:映画型
   - C3:現実活動型
   - C4:キャラクター型
   - C5:シミュレーション型

2. **キーログからの主観感情の推定**
   - キーログデータからユーザーの状態を以下の4つの主観感情として推定します（HMMモデル使用）。
   - 設定状況の魅力
   - 感覚運動的興奮
   - 和みと癒し
   - 難解・頭脳型

3. **ゲームレコメンデーション（共鳴機能）**
   - **データソース**: DBに格納された各ゲームの14因子スコア（`merged_game_scores.csv`）を使用します。
   - **アルゴリズム**:
     1. ゲームの14因子スコアと5つの型の理想パターンとの類似度を計算します。
     2. ユーザーの型適合率とゲームの型類似度を掛け合わせ、最も「共鳴」するゲームを特定します。
     3. 推定された主観感情と相性の良い型を考慮してスコアを調整します。

## 最新の変更点

- **ゲームスコア参照元の変更**:
  - ゲームのスコアデータベースとして、統合版の14因子スコアCSV（`syuyougametitle_score/merged_game_scores.csv`）を使用するように仕様を統一しました。
  - 以前検討された `/DB/result` 内の個別CSV（C1-C5適合率済み）の参照は廃止し、14因子から動的に型適合度を計算するロジックを採用しています。

- **アルゴリズムの適正化**:
  - ユーザーの14因子 -> 5つの型
  - キーログ -> 感情
  - これらを組み合わせて、共鳴する型を持つゲームをレコメンドするフローを確立しました。

## ファイル構成

- `emotion_converter.py`: 14因子を5個の型に変換するロジック、および類似度計算ロジックを提供
- `keylog_analyzer.py`: キーログから特徴量を抽出し、HMMモデルを用いて感情を推定
- `game_recommender.py`: 14因子スコアを持つゲームDBとユーザーの型適合率を照合し、レコメンデーションを実行
- `smart_gui.py`: システムのGUIフロントエンド

## 使用方法

### GUIアプリケーションの起動

```bash
python S.M.A.R.Tver/smart_gui.py
```

### 入力ファイル

1. **キーログCSV**（必須、14因子CSVと排他的）
   - キーログデータを含むCSVファイル
   - 列: `キー情報`, `持続時間(s)`, `遅延時間(s)`, `経過時間(s) (セッション開始からの時間)`

2. **14因子CSV**（オプション、キーログCSVと排他的）
   - 14因子の値を含むCSVファイル
   - 列: `game_title`（オプション）、14因子の列名

3. **HMMモデルファイル**（オプション）
   - HMMモデルのPKLファイル
   - キーログから感情を推定する際に使用

4. **ゲームスコアCSV**（推奨）
   - ゲームタイトルと14因子のスコアを含むCSVファイル
   - デフォルト: `syuyougametitle_score/merged_game_scores.csv`

### パラメータ設定

- **時間窓サイズ**: キーログの特徴量抽出時の時間窓のサイズ（秒）
- **レコメンド数**: レコメンドするゲームの数（Top N）

### 出力

- 結果はGUI上に表示されます
- オプションでCSVファイルに保存できます

## 依存関係

- Python 3.7+
- tkinter
- pandas
- numpy
- hmmlearn（オプション、HMMモデルを使用する場合）
- joblib（オプション、HMMモデルを使用する場合）

## 注意事項

- キーログから14因子を推定する機能は簡易的な実装です。より高精度な推定には、機械学習モデルの使用を推奨します。
- HMMモデルを使用する場合は、`hmmlearn`と`joblib`をインストールしてください。

